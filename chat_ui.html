<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©´ì ‘ê´€ AI ì±„íŒ… - LLM API ì„œë²„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #0f172a;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 280px;
            background: #1e293b;
            border-right: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #334155;
        }

        .sidebar-header h2 {
            color: white;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .chat-history-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #334155;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: #e2e8f0;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-history-item:hover {
            background: #475569;
        }

        .chat-history-item.active {
            background: #667eea;
            color: white;
        }

        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid #334155;
        }

        .model-select {
            width: 100%;
            padding: 12px;
            background: #334155;
            color: white;
            border: 2px solid #475569;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .model-select:hover {
            border-color: #667eea;
            background: #3f4f63;
        }

        .model-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .model-select optgroup {
            background: #1e293b;
            color: #94a3b8;
            font-weight: 600;
            padding: 8px;
        }

        .model-select option {
            background: #334155;
            color: #e2e8f0;
            padding: 10px;
        }

        .settings-group {
            margin-top: 10px;
        }

        .settings-group label {
            display: block;
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .settings-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #475569;
            outline: none;
            -webkit-appearance: none;
        }

        .settings-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
            transition: all 0.2s;
        }

        .settings-group input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.6);
        }

        .settings-group input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.4);
            transition: all 0.2s;
        }

        .settings-group input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.6);
        }

        .temp-value {
            color: #e2e8f0;
            font-weight: 600;
        }

        /* ë©”ì¸ ì±„íŒ… ì˜ì—­ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0f172a;
        }

        .chat-header {
            padding: 20px 30px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h1 {
            color: white;
            font-size: 20px;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            color: #10b981;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .status-badge:hover {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.5);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ë©”ì‹œì§€ ì˜ì—­ */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .user-message .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .assistant-message .message-avatar {
            background: #334155;
        }

        .message-content {
            flex: 1;
            max-width: 800px;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .message-role {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 14px;
        }

        .message-time {
            color: #64748b;
            font-size: 12px;
        }

        .message-text {
            color: #cbd5e1;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #1e293b;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 14.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }

        .message-text:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .user-message .message-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .user-message .message-text:hover {
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .system-message {
            text-align: center;
            margin: 20px 0;
        }

        .system-message .message-text {
            display: inline-block;
            background: #334155;
            color: #94a3b8;
            padding: 8px 16px;
            border-radius: 16px;
            font-size: 13px;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .welcome-screen h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-screen p {
            color: #94a3b8;
            font-size: 1.1em;
            margin-bottom: 40px;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 600px;
        }

        .example-prompt {
            padding: 20px;
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .example-prompt:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .example-prompt .icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .example-prompt .title {
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .example-prompt .desc {
            color: #64748b;
            font-size: 13px;
        }

        /* ì…ë ¥ ì˜ì—­ */
        .input-area {
            padding: 20px 30px;
            background: #1e293b;
            border-top: 1px solid #334155;
        }

        .system-prompt-toggle {
            margin-bottom: 12px;
        }

        .system-prompt-btn {
            background: transparent;
            color: #94a3b8;
            border: 1px solid #334155;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .system-prompt-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .system-prompt-input {
            display: none;
            margin-bottom: 12px;
        }

        .system-prompt-input.active {
            display: block;
        }

        .system-prompt-input textarea {
            width: 100%;
            padding: 12px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            color: #e2e8f0;
            font-family: inherit;
            font-size: 13px;
            resize: vertical;
            min-height: 60px;
        }

        .system-prompt-input textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        #messageInput {
            flex: 1;
            padding: 14px 18px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-family: inherit;
            resize: none;
            max-height: 150px;
            transition: border-color 0.3s;
        }

        #messageInput:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-hint {
            margin-top: 8px;
            color: #64748b;
            font-size: 12px;
            text-align: center;
            padding: 4px 0;
        }

        .input-hint strong {
            color: #94a3b8;
            font-weight: 600;
        }

        .send-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #1e293b;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .clear-btn {
            padding: 8px 16px;
            background: transparent;
            color: #ef4444;
            border: 1px solid #ef4444;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            margin-top: 10px;
            width: 100%;
        }

        .clear-btn:hover {
            background: #ef4444;
            color: white;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 5px;
            transition: all 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 100;
                transition: left 0.3s;
            }

            .sidebar.active {
                left: 0;
            }

            .example-prompts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸ¤– ë©´ì ‘ê´€ AI</h2>
                <button class="new-chat-btn" onclick="startNewChat()">
                    â• ìƒˆ ëŒ€í™” ì‹œì‘
                </button>
            </div>

            <div class="sidebar-content" id="chatHistory">
                <!-- ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <div class="sidebar-footer">
                <select class="model-select" id="modelSelect">
                    <option value="gpt-5.2" selected>GPT-5.2 (ChatGPT)</option>
                    <option value="deepseek-r1:70b">DeepSeek-R1 70B (ì¶”ë¡  íŠ¹í™”)</option>
                    <option value="qwen3:32b">Qwen3 32B (ê· í˜•)</option>
                </select>

                <div class="settings-group">
                    <label>
                        Temperature: <span class="temp-value" id="tempValue">0.7</span>
                    </label>
                    <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7">
                </div>

                <button class="clear-btn" onclick="clearAllChats()">
                    ğŸ—‘ï¸ ëª¨ë“  ëŒ€í™” ì‚­ì œ
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ì±„íŒ… ì˜ì—­ -->
        <div class="chat-area">
            <div class="chat-header">
                <h1>ë©´ì ‘ê´€ AI ì±„íŒ…</h1>
                <div class="status-badge">
                    <div class="status-dot"></div>
                    <span id="statusText">ì„œë²„ ì—°ê²° ì¤‘...</span>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-screen" id="welcomeScreen">
                    <h2>ğŸ‘‹ ë©´ì ‘ê´€ AIì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h2>
                    <p>ì „ë¬¸ ë©´ì ‘ê´€ì´ ë‹¹ì‹ ì˜ ì—­ëŸ‰ì„ í‰ê°€í•˜ê³  ì§ˆë¬¸ì„ ì œê³µí•©ë‹ˆë‹¤</p>

                    <div class="example-prompts">
                        <div class="example-prompt" onclick="setExamplePrompt('frontend')">
                            <div class="icon">ğŸ’¼</div>
                            <div class="title">í”„ë¡ íŠ¸ì—”ë“œ ë©´ì ‘</div>
                            <div class="desc">React ê°œë°œì 3ë…„ ê²½ë ¥</div>
                        </div>
                        <div class="example-prompt" onclick="setExamplePrompt('backend')">
                            <div class="icon">ğŸ–¥ï¸</div>
                            <div class="title">ë°±ì—”ë“œ ë©´ì ‘</div>
                            <div class="desc">Node.js/Python 5ë…„ ê²½ë ¥</div>
                        </div>
                        <div class="example-prompt" onclick="setExamplePrompt('data')">
                            <div class="icon">ğŸ“Š</div>
                            <div class="title">ë°ì´í„° ë¶„ì„ê°€</div>
                            <div class="desc">Python/SQL 2ë…„ ê²½ë ¥</div>
                        </div>
                        <div class="example-prompt" onclick="setExamplePrompt('design')">
                            <div class="icon">ğŸ¨</div>
                            <div class="title">UI/UX ë””ìì´ë„ˆ</div>
                            <div class="desc">Figma 4ë…„ ê²½ë ¥</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="system-prompt-toggle">
                    <button class="system-prompt-btn" id="systemPromptBtn">
                        âš™ï¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì„¤ì •
                    </button>
                </div>

                <div class="system-prompt-input" id="systemPromptInput">
                    <textarea id="systemPrompt" placeholder="ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë‹¹ì‹ ì€ ì „ë¬¸ ë©´ì ‘ê´€ì…ë‹ˆë‹¤...)">ë‹¹ì‹ ì€ ì „ë¬¸ ë©´ì ‘ê´€ì…ë‹ˆë‹¤. ì§€ì›ìì˜ ì—­ëŸ‰ì„ í‰ê°€í•˜ê¸° ìœ„í•´ ì ì ˆí•œ ì§ˆë¬¸ì„ í•˜ì„¸ìš”.</textarea>
                </div>

                <div class="input-wrapper">
                    <textarea
                        id="messageInput"
                        placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Enter: ì „ì†¡, Shift+Enter: ì¤„ë°”ê¿ˆ)"
                        rows="1"
                    ></textarea>
                    <button class="send-btn" id="sendBtn">
                        <span>ì „ì†¡</span>
                        <span>ğŸ“¤</span>
                    </button>
                </div>
                <div class="input-hint">
                    ğŸ’¡ <strong>Enter</strong>ë¡œ ì „ì†¡ | <strong>Shift + Enter</strong>ë¡œ ì¤„ë°”ê¿ˆ
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL ìë™ ê°ì§€
        const API_BASE_URL = window.location.origin;
        const API_ENDPOINT = `${API_BASE_URL}/v1/chat/completions`;
        const HEALTH_ENDPOINT = `${API_BASE_URL}/health`;

        // ì „ì—­ ìƒíƒœ
        let conversations = JSON.parse(localStorage.getItem('conversations')) || [];
        let currentConversationId = null;
        let messageHistory = [];
        let isSending = false; // ì¤‘ë³µ ì „ì†¡ ë°©ì§€ í”Œë˜ê·¸

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            checkServerStatus();
            loadChatHistory();
            setupEventListeners();

            // ì €ì¥ëœ ëŒ€í™”ê°€ ìˆìœ¼ë©´ ë§ˆì§€ë§‰ ëŒ€í™” ë¡œë“œ
            if (conversations.length > 0) {
                loadConversation(conversations[0].id);
            }
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // Temperature ìŠ¬ë¼ì´ë”
            document.getElementById('temperature').addEventListener('input', (e) => {
                document.getElementById('tempValue').textContent = e.target.value;
            });

            // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ í† ê¸€ ë²„íŠ¼
            document.getElementById('systemPromptBtn').addEventListener('click', () => {
                toggleSystemPrompt();
            });

            // ì „ì†¡ ë²„íŠ¼ í´ë¦­
            document.getElementById('sendBtn').addEventListener('click', () => {
                sendMessage();
            });

            // Enter í‚¤ë¡œ ì „ì†¡ (Shift+EnterëŠ” ì¤„ë°”ê¿ˆ)
            document.getElementById('messageInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // ìë™ ë†’ì´ ì¡°ì ˆ
            document.getElementById('messageInput').addEventListener('input', (e) => {
                e.target.style.height = 'auto';
                e.target.style.height = e.target.scrollHeight + 'px';
            });
        }

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            try {
                const response = await fetch(HEALTH_ENDPOINT);
                const data = await response.json();

                if (data.status === 'ok') {
                    document.getElementById('statusText').textContent = 'ì„œë²„ ì •ìƒ';
                } else {
                    document.getElementById('statusText').textContent = 'ì¼ë¶€ ì œí•œ';
                }
            } catch (error) {
                document.getElementById('statusText').textContent = 'ì—°ê²° ì‹¤íŒ¨';
            }
        }

        // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ í† ê¸€
        function toggleSystemPrompt() {
            const input = document.getElementById('systemPromptInput');
            input.classList.toggle('active');
        }

        // ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ì„¤ì •
        function setExamplePrompt(type) {
            const examples = {
                frontend: {
                    system: 'ë‹¹ì‹ ì€ ì „ë¬¸ ë©´ì ‘ê´€ì…ë‹ˆë‹¤. ì§€ì›ìì˜ ì—­ëŸ‰ì„ í‰ê°€í•˜ê¸° ìœ„í•´ ì ì ˆí•œ ì§ˆë¬¸ì„ í•˜ì„¸ìš”.',
                    user: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë¡œ ì§€ì›í–ˆìŠµë‹ˆë‹¤. React 3ë…„ ê²½ë ¥ì´ ìˆê³  TypeScriptë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.'
                },
                backend: {
                    system: 'ë‹¹ì‹ ì€ ì „ë¬¸ ë©´ì ‘ê´€ì…ë‹ˆë‹¤. ë°±ì—”ë“œ ê°œë°œìì˜ ê¸°ìˆ  ì—­ëŸ‰ê³¼ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì„ í‰ê°€í•˜ì„¸ìš”.',
                    user: 'Node.jsì™€ Pythonì„ ì‚¬ìš©í•˜ëŠ” ë°±ì—”ë“œ ê°œë°œìì…ë‹ˆë‹¤. 5ë…„ ê²½ë ¥ì´ë©° MSA ì•„í‚¤í…ì²˜ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.'
                },
                data: {
                    system: 'ë‹¹ì‹ ì€ ì „ë¬¸ ë©´ì ‘ê´€ì…ë‹ˆë‹¤. ë°ì´í„° ë¶„ì„ê°€ì˜ ë¶„ì„ ëŠ¥ë ¥ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ë¥¼ í‰ê°€í•˜ì„¸ìš”.',
                    user: 'ë°ì´í„° ë¶„ì„ê°€ë¡œ ì§€ì›í•©ë‹ˆë‹¤. Python, SQL, Tableauë¥¼ ì‚¬ìš©í•˜ë©° 2ë…„ ê²½ë ¥ì…ë‹ˆë‹¤.'
                },
                design: {
                    system: 'ë‹¹ì‹ ì€ ì „ë¬¸ ë©´ì ‘ê´€ì…ë‹ˆë‹¤. UI/UX ë””ìì´ë„ˆì˜ ë””ìì¸ ì‚¬ê³ ì™€ ì‚¬ìš©ì ì¤‘ì‹¬ ì ‘ê·¼ ë°©ì‹ì„ í‰ê°€í•˜ì„¸ìš”.',
                    user: 'UI/UX ë””ìì´ë„ˆì…ë‹ˆë‹¤. Figma, Adobe XDë¥¼ ì‚¬ìš©í•˜ë©° 4ë…„ ê²½ë ¥ì…ë‹ˆë‹¤.'
                }
            };

            const example = examples[type];
            document.getElementById('systemPrompt').value = example.system;
            document.getElementById('messageInput').value = example.user;

            // ìƒˆ ëŒ€í™” ì‹œì‘
            startNewChat();
        }

        // ìƒˆ ëŒ€í™” ì‹œì‘
        function startNewChat() {
            currentConversationId = Date.now().toString();
            messageHistory = [];

            // ì›°ì»´ ìŠ¤í¬ë¦° ìˆ¨ê¸°ê¸°
            const welcomeScreen = document.getElementById('welcomeScreen');
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }

            // ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ ë¹„ìš°ê¸°
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';

            // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€
            addSystemMessage('ìƒˆë¡œìš´ ë©´ì ‘ ì„¸ì…˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');

            // ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
            const conversation = {
                id: currentConversationId,
                title: 'ìƒˆ ëŒ€í™”',
                messages: [],
                timestamp: Date.now()
            };
            conversations.unshift(conversation);
            saveConversations();
            loadChatHistory();
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            // ì¤‘ë³µ ì „ì†¡ ë°©ì§€
            if (isSending) return;

            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            if (!message) return;

            // ì „ì†¡ ì‹œì‘
            isSending = true;

            // ëŒ€í™”ê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ì‹œì‘
            if (!currentConversationId) {
                startNewChat();
            }

            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            addMessage('user', message);
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // ë©”ì‹œì§€ ê¸°ë¡ì— ì¶”ê°€
            messageHistory.push({
                role: 'user',
                content: message
            });

            // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            showTypingIndicator();

            // ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('sendBtn').disabled = true;

            // API ìš”ì²­ ì¤€ë¹„
            const systemPrompt = document.getElementById('systemPrompt').value.trim();
            const messages = [];

            if (systemPrompt) {
                messages.push({
                    role: 'system',
                    content: systemPrompt
                });
            }

            // ì´ì „ ëŒ€í™” ê¸°ë¡ í¬í•¨ (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê´€ë¦¬)
            messages.push(...messageHistory);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-yMF-iN0klm6zt0E1D9nrYFejxozobeq-sNdNSqcU_hA'
                    },
                    body: JSON.stringify({
                        model: document.getElementById('modelSelect').value,
                        messages: messages,
                        temperature: parseFloat(document.getElementById('temperature').value),
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
                }

                const data = await response.json();
                const assistantMessage = data.choices[0].message.content;

                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°
                hideTypingIndicator();

                // ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
                addMessage('assistant', assistantMessage);

                // ë©”ì‹œì§€ ê¸°ë¡ì— ì¶”ê°€
                messageHistory.push({
                    role: 'assistant',
                    content: assistantMessage
                });

                // ëŒ€í™” ì €ì¥
                saveCurrentConversation();

            } catch (error) {
                hideTypingIndicator();
                addSystemMessage('âŒ ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('sendBtn').disabled = false;
                isSending = false; // ì „ì†¡ ì™„ë£Œ, í”Œë˜ê·¸ í•´ì œ
            }
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(role, content) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;

            const avatarEmoji = role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            const roleName = role === 'user' ? 'ì§€ì›ì' : 'ë©´ì ‘ê´€';
            const time = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

            messageDiv.innerHTML = `
                <div class="message-avatar">${avatarEmoji}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-role">${roleName}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-text">${content}</div>
                </div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€
        function addSystemMessage(content) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message system-message';
            messageDiv.innerHTML = `<div class="message-text">${content}</div>`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const indicator = document.createElement('div');
            indicator.id = 'typingIndicator';
            indicator.className = 'typing-indicator active';
            indicator.innerHTML = `
                <div class="message-avatar">ğŸ¤–</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            container.appendChild(indicator);
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // ëŒ€í™” ì €ì¥
        function saveCurrentConversation() {
            if (!currentConversationId) return;

            const conversation = conversations.find(c => c.id === currentConversationId);
            if (conversation) {
                conversation.messages = messageHistory;
                conversation.timestamp = Date.now();

                // ì²« ë©”ì‹œì§€ë¡œ ì œëª© ì„¤ì •
                if (messageHistory.length > 0) {
                    const firstUserMessage = messageHistory.find(m => m.role === 'user');
                    if (firstUserMessage) {
                        conversation.title = firstUserMessage.content.substring(0, 30) + '...';
                    }
                }

                saveConversations();
                loadChatHistory();
            }
        }

        // ëŒ€í™” ëª©ë¡ ì €ì¥
        function saveConversations() {
            localStorage.setItem('conversations', JSON.stringify(conversations));
        }

        // ëŒ€í™” ê¸°ë¡ ë¡œë“œ
        function loadChatHistory() {
            const historyContainer = document.getElementById('chatHistory');
            historyContainer.innerHTML = '';

            if (conversations.length === 0) {
                historyContainer.innerHTML = '<div style="color: #64748b; text-align: center; padding: 20px; font-size: 13px;">ì €ì¥ëœ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            conversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = 'chat-history-item';
                if (conv.id === currentConversationId) {
                    item.classList.add('active');
                }
                item.textContent = conv.title;
                item.onclick = () => loadConversation(conv.id);
                historyContainer.appendChild(item);
            });
        }

        // íŠ¹ì • ëŒ€í™” ë¡œë“œ
        function loadConversation(id) {
            const conversation = conversations.find(c => c.id === id);
            if (!conversation) return;

            currentConversationId = id;
            messageHistory = [...conversation.messages];

            // ì›°ì»´ ìŠ¤í¬ë¦° ìˆ¨ê¸°ê¸°
            const welcomeScreen = document.getElementById('welcomeScreen');
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }

            // ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';

            // ë©”ì‹œì§€ í‘œì‹œ
            messageHistory.forEach(msg => {
                addMessage(msg.role, msg.content);
            });

            loadChatHistory();
        }

        // ëª¨ë“  ëŒ€í™” ì‚­ì œ
        function clearAllChats() {
            if (confirm('ëª¨ë“  ëŒ€í™”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                conversations = [];
                currentConversationId = null;
                messageHistory = [];
                saveConversations();
                loadChatHistory();

                // ì›°ì»´ ìŠ¤í¬ë¦° í‘œì‹œ
                const container = document.getElementById('messagesContainer');
                container.innerHTML = '';
                const welcomeScreen = document.getElementById('welcomeScreen');
                if (welcomeScreen) {
                    welcomeScreen.style.display = 'flex';
                }
            }
        }

        // 10ì´ˆë§ˆë‹¤ ì„œë²„ ìƒíƒœ í™•ì¸
        setInterval(checkServerStatus, 10000);
    </script>
</body>
</html>
